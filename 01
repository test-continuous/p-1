<script>
    let latestTimestamp = {{ latest_timestamp }}; // Initial timestamp

    function refreshData() {
        location.reload(); // Manually refresh the page
    }

    function checkForUpdates() {
        console.log("Checking for updates...");

        const params = new URLSearchParams({
            environment: "{{ environment }}",
            region: "{{ region }}",
            date: "{{ date }}",
            last_checked: latestTimestamp
        });

        fetch(`/check_update?${params}`)
            .then((response) => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then((data) => {
                console.log("Response received:", data);
                if (data.updated) {
                    console.log("New update detected, refreshing...");
                    location.reload(); // Auto-refresh the page if new data is available
                }
            })
            .catch((error) => console.error("Error checking for updates:", error));
    }

    // Check for updates every 60 seconds
    setInterval(checkForUpdates, 60000);
</script>
